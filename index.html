<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no,viewport-fit=cover" />
  <title>WeeWoo Map Friend - Emergency Services Map</title>
  
  <!-- PWA Meta Tags -->
  <meta name="description" content="Interactive emergency services mapping for Victoria, Australia. Find SES, CFA, Ambulance, Police, and FRV boundaries and facilities.">
  <meta name="theme-color" content="#1976d2">
  <meta name="background-color" content="#ffffff">
  <meta name="display" content="standalone">
  <meta name="orientation" content="any">
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="/manifest.json">
  
  <!-- iOS PWA Meta Tags -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="WeeWoo Map">
  <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiByeD0iMjQiIGZpbGw9IiMxOTc2ZDIiLz4KPHN2ZyB4PSI0OCIgeT0iNDgiIHdpZHRoPSI5NiIgaGVpZ2h0PSI5NiIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJ3aGl0ZSI+CjxwYXRoIGQ9Ik0xMiAyQzguMTMgMiA1IDUuMTMgNSA5YzAgNS4yNSA3IDEzIDcgMTNzNy03Ljc1IDctMTNjMC0zLjg3LTMuMTMtNy03LTd6bTAgOS41Yy0xLjM4IDAtMi41LTEuMTItMi41LTIuNXMxLjEyLTIuNSAyLjUtMi41IDIuNSAxLjEyIDIuNSAyLjUtMS4xMiAyLjUtMi41IDIuNXoiLz4KPC9zdmc+Cjwvc3ZnPgo=">
  
  <!-- Windows PWA Meta Tags -->
  <meta name="msapplication-TileColor" content="#1976d2">
  <meta name="msapplication-config" content="browserconfig.xml">
  
  <!-- Open Graph Meta Tags -->
  <meta property="og:title" content="WeeWoo Map Friend">
  <meta property="og:description" content="Interactive emergency services mapping for Victoria, Australia">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://goatindex.github.io/mapexp.github.io/">
  <meta property="og:image" content="https://goatindex.github.io/mapexp.github.io/docs/assets/sidebar-all-active.svg">
  
  <!-- Twitter Card Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="WeeWoo Map Friend">
  <meta name="twitter:description" content="Interactive emergency services mapping for Victoria, Australia">
  <meta name="twitter:image" content="https://goatindex.github.io/mapexp.github.io/docs/assets/sidebar-all-active.svg">
  
  <!-- Stylesheets -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <div id="map"></div>
  <div class="layer-menu" id="layerMenu">
  <div class="search-sticky">
  <div id="sidebarTitle" class="sidebar-title"><span class="title-emojis">ğŸš¨ğŸ—ºï¸ğŸ«¶</span> | WeeWoo Map Friend </div>
    <div class="sidebar-tools" aria-label="Quick tools">
  <button id="sidebarBtn3" class="sidebar-tool-btn" type="button" title="Information" aria-label="Information">â„¹ï¸</button>
  <button id="sidebarBtn2" class="sidebar-tool-btn" type="button" title="Documentation" aria-label="Documentation">ğŸ“š</button>
  <button id="sidebarBtn1" class="sidebar-tool-btn" type="button" title="Reset to default" aria-label="Reset to default">â™»ï¸</button>
    </div>
    <div class="search-box-wrap">
      <input type="text" class="search-box" id="globalSidebarSearch" placeholder="Search all layers..." autocomplete="off" />
      <div id="sidebarSearchDropdown" class="sidebar-search-dropdown"></div>
    </div>
  </div>
  <h4 id="activeHeader"><span class="collapse-arrow">&#9660;</span>ğŸ“Œ All Active</h4>
  <div class="collapsible-list" id="activeList" style="display: none;"></div>
    
    <div class="divider"></div>
  <h4 id="showAllHeader" class="collapsed"><span class="collapse-arrow">&#9660;</span>ğŸ§¾ Show All</h4>
    <div class="collapsible-list" id="showAllList" style="display: none;">
  <label><input type="checkbox" id="toggleAllSES" checked> ğŸ‘· SES Response Areas</label>
  <label><input type="checkbox" id="toggleAllLGAs" checked> ğŸ›ï¸ Local Government Areas</label>
  <label><input type="checkbox" id="toggleAllCFA" checked> ğŸ”¥ CFA Response Areas</label>
  <label><input type="checkbox" id="toggleAllAmbulance"> ğŸš‘ Ambulance Stations</label>
  <label><input type="checkbox" id="toggleAllPolice"> ğŸ‘® Police Stations</label>
  <label><input type="checkbox" id="toggleAllFRV"> ï¿½ Fire Rescue Victoria</label>
    </div>
    <div class="divider"></div>
  <h4 id="sesHeader" class="collapsed"><span class="collapse-arrow">&#9660;</span>ğŸ‘· SES Response Areas</h4>
    <div class="collapsible-list" id="sesList" style="display: none;"></div>
    <div class="divider"></div>
  <h4 id="lgaHeader" class="collapsed"><span class="collapse-arrow">&#9660;</span>ğŸ›ï¸ Local Government Areas</h4>
    <div class="collapsible-list" id="lgaList" style="display: none;"></div>
  <div class="divider"></div>
  <h4 id="cfaHeader" class="collapsed"><span class="collapse-arrow">&#9660;</span>ğŸ”¥ CFA Response Areas</h4>
  <div class="collapsible-list" id="cfaList" style="display: none;"></div>
  <div class="divider"></div>
  <h4 id="ambulanceHeader" class="collapsed"><span class="collapse-arrow">&#9660;</span>ğŸš‘ Ambulance Stations</h4>
  <div class="collapsible-list" id="ambulanceList" style="display: none;"></div>
  <div class="divider"></div>
  <h4 id="policeHeader" class="collapsed"><span class="collapse-arrow">&#9660;</span>ğŸ‘® Police Stations</h4>
  <div class="collapsible-list" id="policeList" style="display: none;"></div>
  <div class="divider"></div>
  <h4 id="frvHeader" class="collapsed"><span class="collapse-arrow">&#9660;</span>ï¿½ Fire Rescue Victoria</h4>
  <div class="collapsible-list" id="frvList" style="display: none;"></div>
  <div class="divider"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@turf/turf@6.5.0/turf.min.js"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <!-- Proj4 for coordinate conversion (required by coordConvert.js) -->
  <script src="https://cdn.jsdelivr.net/npm/proj4@2.9.2/dist/proj4.min.js"></script>
  
  <!-- Core state and configuration -->
  <script src="js/state.js"></script>
  <script src="js/config.js"></script>
  <script src="js/utils.js"></script>
  <script src="js/device.js"></script>
  <script src="js/native/features.js"></script>
  
  <!-- Utilities -->
  <script src="js/utils/coordConvert.js"></script>
  <script src="js/utils/errorUI.js"></script>
  
  <!-- Feature management -->
  <script src="js/labels.js"></script>
  <script src="js/emphasise.js"></script>
  <script src="js/polygonPlus.js"></script>
  
  <!-- Data loaders -->
  <script src="js/loaders/polygons.js"></script>
  <script src="js/loaders/ambulance.js"></script>
  <script src="js/loaders/police.js"></script>
  <script src="js/loaders/sesFacilities.js"></script>
  <script src="js/loaders/cfaFacilities.js"></script>
  <script src="js/loaders/sesUnits.js"></script>
  <script src="js/loaders/waterwaycent.js"></script>
  
  <!-- UI components -->
  <script src="js/ui/collapsible.js"></script>
  <script src="js/ui/search.js"></script>
  <script src="js/ui/activeList.js"></script>
  <script src="js/ui/mobileDocsNav.js"></script>
  <!-- Unified FAB framework -->
  <script src="js/fab/BaseFAB.js?v=20250101_004"></script>
  <script src="js/fab/FABManager.js?v=20250101_004"></script>
  <script src="js/fab/DocsFAB.js?v=20250101_004"></script>
  <script src="js/fab/SidebarToggleFAB.js?v=20250101_004"></script>

  <!-- Preloader and bootstrap -->
  <script src="js/preloader.js"></script>
  <script src="js/bootstrap.js"></script>
  
  <!-- Service Worker Registration -->
  <script>
    // Register service worker for PWA functionality
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then(registration => {
            console.log('PWA: Service Worker registered successfully:', registration.scope);
            
            // Handle service worker updates
            registration.addEventListener('updatefound', () => {
              const newWorker = registration.installing;
              newWorker.addEventListener('statechange', () => {
                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                  // New service worker available, show update notification
                  console.log('PWA: New version available');
                  if (confirm('A new version of WeeWoo Map Friend is available. Update now?')) {
                    newWorker.postMessage({ type: 'SKIP_WAITING' });
                    window.location.reload();
                  }
                }
              });
            });
          })
          .catch(error => {
            console.warn('PWA: Service Worker registration failed:', error);
          });
      });
    }
    
    // Handle PWA install prompt
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
      console.log('PWA: Install prompt available');
      e.preventDefault();
      deferredPrompt = e;
      
      // Show custom install button or notification
      setTimeout(() => {
        if (deferredPrompt && !window.DeviceContext.getContext().isPWA) {
          const installMessage = document.createElement('div');
          installMessage.style.cssText = `
            position: fixed; top: 10px; left: 50%; transform: translateX(-50%);
            background: #1976d2; color: white; padding: 8px 16px; border-radius: 6px;
            font-size: 14px; z-index: 4000; cursor: pointer; box-shadow: 0 2px 8px rgba(0,0,0,0.2);
          `;
          installMessage.textContent = 'ğŸ“± Install WeeWoo Map as an app';
          installMessage.addEventListener('click', async () => {
            if (deferredPrompt) {
              deferredPrompt.prompt();
              const { outcome } = await deferredPrompt.userChoice;
              console.log('PWA: Install prompt result:', outcome);
              deferredPrompt = null;
              installMessage.remove();
            }
          });
          document.body.appendChild(installMessage);
          
          // Auto-hide after 10 seconds
          setTimeout(() => installMessage.remove(), 10000);
        }
      }, 2000);
    });
    
    // Handle successful app install
    window.addEventListener('appinstalled', (e) => {
      console.log('PWA: App installed successfully');
      deferredPrompt = null;
    });
  </script>
  <!-- Last updated line -->
  <div id="lastUpdated" style="position:fixed;left:12px;bottom:8px;font-size:0.95em;color:#444;background:rgba(255,255,255,0.85);padding:4px 10px;border-radius:6px;z-index:2000;pointer-events:none;">
    <!--#include file="last-updated.txt" -->
  </div>

  <!-- Information Modal -->
  <div id="infoOverlay" class="app-overlay" hidden></div>
  <div id="infoModal" class="app-modal" role="dialog" aria-modal="true" aria-labelledby="infoTitle" hidden>
    <div class="app-modal-content">
      <div class="app-modal-header">
        <h2 id="infoTitle" class="app-modal-title">Information</h2>
        <button id="infoClose" class="app-modal-close" type="button" aria-label="Close">âœ–</button>
      </div>
      <div class="app-modal-body">
        <p>Welcome to WeeWoo Map Friend. This single-page panel provides a quick overview of the app and handy tips:</p>
        <ul>
          <li>Use the sidebar search to find SES, LGA, CFA, Ambulance, and Police items.</li>
          <li>â€œAll Activeâ€ shows your current selections with controls for emphasise, label, and weather.</li>
          <li>The â™»ï¸ button resets the page to a clean starting state.</li>
        </ul>
        <p>For full documentation, open ğŸ“š Docs.</p>
        </ul>
        <h3>Who's behind this project?</h3>
        <p>WeeWoo Map Friend is a hobby project developed (clumsily) by Kirk Nicholls. He's doing his best. </p>
        <h4>What's the point?</h4>
        <ul>
          <li>Provide a user-friendly interface for exploring and interacting with map info handy to local emergncy services.</li>
          <li>To learn more about software development and using mapping software specifically.</li>
          <li>Bridge a gap between full-featured tools like EM-COP or QGIS and Google Maps.</li>
          <li>Personal use, to do help me be a better emergency services human.</li>
          <li>It's a bit of fun, isn't it?</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Docs Drawer -->
  <div id="docsOverlay" class="app-overlay" hidden></div>
  <aside id="docsDrawer" class="docs-drawer" aria-labelledby="docsTitle" hidden>
    <header class="docs-header">
      <h2 id="docsTitle">Documentation</h2>
      <button id="docsClose" class="docs-close" aria-label="Close">âœ–</button>
    </header>
    <div class="docs-body fab-mode">
      <main id="docsContent" class="docs-content" tabindex="0" aria-live="polite">
        <h2>Welcome to Documentation</h2>
        <p>On mobile devices, tap the blue <strong>"ğŸ“š Documentation Pages"</strong> button at the top to navigate between topics.</p>
        <p>On desktop, use the navigation panel on the left.</p>
        <p>Choose a topic to get started!</p>
      </main>
    </div>
  </aside>

  <!-- FAB Container -->
  <div id="docsFabContainer" class="docs-fab-container"></div>

</body>
</html>
